<Project>
  <PropertyGroup>
    <Linux64BuildDir>linux-x64</Linux64BuildDir>
    <LinuxBinaryLibraryPath64>lib64\liblua53.so</LinuxBinaryLibraryPath64>
    <ExternalLuaPath>$([System.IO.Path]::GetFullPath($(ExternalLuaDir)))</ExternalLuaPath>
  </PropertyGroup>
  <Target Name="BuildLuaLinux" BeforeTargets="BeforeBuild" Condition="'$(OS)'=='Unix' and !Exists('/usr/lib/libc.dylib')">
    <Message Text="Building Linux Lua library (x64)" />
    <Exec Command="export CFLAGS=-m64" WorkingDirectory="$(ExternalLuaPath)" Condition="!Exists('$(ExternalLuaPath)\$(Linux64BuildDir)')" />
    <Exec Command="export LDFLAGS=-m64" WorkingDirectory="$(ExternalLuaPath)" Condition="!Exists('$(ExternalLuaPath)\$(Linux64BuildDir)')" />
    <Exec Command="mkdir $(ExternalLuaPath)\$(Linux64BuildDir)" WorkingDirectory="$(ExternalLuaPath)" Condition="!Exists('$(ExternalLuaPath)\$(Linux64BuildDir)')" />
    <Exec Command="cmake $(ExternalLuaPath) " WorkingDirectory="$(ExternalLuaPath)\$(Linux64BuildDir)" Condition="!Exists('$(ExternalLuaPath)\$(Linux64BuildDir)\CMakeCache.txt')" />
    <Exec Command="cmake --build . --config Release" WorkingDirectory="$(ExternalLuaPath)\$(Linux64BuildDir)" />
    <Copy SourceFiles="$(ExternalLuaPath)\$(Linux64BuildDir)\$(LinuxBinaryLibraryPath64)" DestinationFolder="$(OutputRuntimeDir)\$(Linux64BuildDir)" SkipUnchangedFiles="true" />
  </Target>
  <Target Name="CleanLuaLinux" AfterTargets="Clean" Condition="'$(OS)'=='Unix' and !Exists('/usr/lib/libc.dylib')">
      <Message Text="Cleaning Lua library (x64)" />
      <RemoveDir Directories="$(ExternalLuaPath)\$(Linux64BuildDir); $(OutputRuntimeDir)\$(Linux64BuildDir) " />
  </Target>
</Project>